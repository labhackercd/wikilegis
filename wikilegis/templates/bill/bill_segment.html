{% extends "bill/_base.html" %}

{% load static %}
{% load i18n %}
{% load render_comments from comments2 %}
{% load cropping %}

{% block content3 %}
    <div class="col m8 pl-full">
        <div class="bah">
            <div class="article-head">
                <div class="quote-s"></div>
                <div class="article-content flow-text">
                    <span id="original" class="article-content" data-raw-content="{{ segment.content }}">{{ segment.content|linebreaks }}</span>
                </div>
                <div class="quote-f"></div>
            </div>

            {% if author %}
                <div class="pl-author">
                    <div class="avatr">
                        <div class="pic" style="background-image: url('{% cropped_thumbnail author.user 'cropping' %}')"></div>
                    </div>
                    <div class="info">
                        <span class="author"><a href="{{ author.user.get_absolute_url }}">{{ author.user }}</a></span>
                    </div>
                </div>
            {% endif %}
          
            <div class="interact">
                <ul>
                    <li>
                        {% include "bill/_choosing_button_2.html" %}
                    </li>
                    <li> | </li>
                    <li><a href="{% url 'create_amendment' segment.bill.id segment.id %}"><i class="material-icons">edit</i> {% trans "Change" %}</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="divider"></div>

        <div class="row">
            <div class="col s12 tabs-content">
                <!-- pls fix -->
                <!--<h5>{% trans "Proposals" %}</h5>-->
                <br />

                {% for amendment in segment.amendments.all %}
                    <br />
                    <div class="proposal" id="amendment-{{ amendment.pk }}">
                        <div class="avatr">
                            <div class="pic" style="background-image: url('{% cropped_thumbnail amendment.author 'cropping' %}')"></div>
                        </div>

                        <div class="content" data-raw-content="{{ amendment.content|escape }}">
                            <span class="author"><span class="user">{% with user=amendment.author %}{% include "auth2/_user_display_name.html" %}{% endwith %}</span> {% trans "proposed:" %}</span>
                            <div class="pp">
                                {{ amendment.content|linebreaks }}
                            </div>
                            <div class="right-align">
                                {% include "bill/_choosing_button_2.html" %}
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col s11 offset-s1">
                            {% render_comments amendment %}
                        </div>
                    </div>
                {% empty %}
                    <span>Empty</span>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}


{% block partialscript %}
    <script type="text/javascript">
        $(function() {
            var original = $('#original').attr('data-raw-content');
            $('.proposal .content').each(function(i, cur) {
                var $cur = $(cur);
                var current = $cur.attr('data-raw-content');
                $cur.find('.pp').html(changesToMarkup(wlDiff(original, current)));
            });
        });
    </script>
{% endblock %}
